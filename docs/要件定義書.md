# KaigiNote 要件定義書

## 1. 背景・目的
- 知人と定期的に開催している勉強会の情報を一元管理したい。  
- 開催日時、参加者、場所、費用、内容などを記録し、履歴を振り返りやすくする。  
- 将来的には、参加者ごとの費用負担を管理し、公平な精算を行いやすくしたい。  

## 2. ターゲットユーザー
- 勉強会の主催者・参加者（ユーザー登録を行う）  
- 現段階では少人数（本人＋知人）を想定  

## 3. システム概要
- **メイン機能**  
  - ユーザー認証（メールアドレス＋パスワード）  
  - 勉強会（イベント）の登録・更新・削除  
  - 勉強会の詳細画面での参加者登録（支払い金額含む）  
  - Discordへの通知（新規登録時）  

- **オプション／将来的に拡張が見込まれる機能**  
  - 検索機能の高度化（複数条件・複合条件）  
  - 通知タイミングのカスタマイズ（開催〇日前など）  
  - ステータス管理のルール拡張（`planned`→`done`→`settled` など）  
  - レポート機能（累計費用や週/月単位の集計）  

## 4. 機能要件

### 4.1 ユーザー管理

1. **ユーザー登録**  
   - 入力項目：ユーザー名、メールアドレス、パスワード  
   - 処理内容：パスワードのハッシュ化後にDB保存  
   - バリデーション：メールアドレスの形式・重複チェック／パスワードの最低文字数など  

2. **ログイン**  
   - 入力項目：メールアドレス、パスワード  
   - 処理内容：認証成功時にセッション or トークン発行  
   - 認証方法：JWT or セッション＋クッキー（どちらか）  

3. **ログアウト**  
   - 処理内容：セッション破棄 or トークン無効化  

### 4.2 勉強会（イベント）管理

1. **イベント登録**  
   - 入力項目：開催日時、場所、内容、ステータス（初期値`planned`など）  
   - Discord通知：新規登録完了時にWebhook連携でメッセージ送信  
   - バリデーション：日時形式、必須項目チェック  

2. **イベント一覧・検索**  
   - 一覧表示：開催日降順または昇順などでソート  
   - 検索条件：日時、参加者、場所、内容  
   - 検索方法：複数条件を組み合わせ可能（AND検索）  

3. **イベント詳細**  
   - 表示内容：日付、場所、内容、ステータス、参加者一覧（支払金額含む）  
   - ステータス変更：`planned`→`done`など  

4. **イベント更新**  
   - 更新対象：日付、場所、内容、ステータスなど  
   - 通知（オプション）：必要ならば更新時にもDiscord通知を送信  

5. **イベント削除**  
   - イベントIDを指定して削除  
   - 関連する参加者データの扱い（**物理削除** もしくは **ステータス更新による論理削除** など）を検討  

### 4.3 参加者・費用管理

1. **参加者の登録**  
   - **エンドポイント例**: `[POST] /api/events/{event_id}/participants`  
   - **入力項目**:  
     - `user_id`（参加ユーザのID）  
     - `paid_amount`（支払い金額）  
   - **処理内容**:  
     - イベントID(`event_id`)とユーザーID(`user_id`)を紐づけて、イベント参加テーブル(`Event_Participants`)へ登録する。  
     - 「支払い金額」を個別管理し、後で精算情報を確認できるようにする。

2. **参加者の一覧取得**  
   - **エンドポイント例**: `[GET] /api/events/{event_id}/participants`  
   - **処理内容**:  
     - イベントIDをキーに、中間テーブル(`Event_Participants`)とユーザーテーブル(`Users`)を結合し、参加者情報（ユーザー名、支払い金額 など）を取得。  

3. **参加者の更新**  
   - **エンドポイント例**: `[PUT/PATCH] /api/events/{event_id}/participants/{participant_id}`  
   - **入力項目**:  
     - `paid_amount`など、更新が必要な項目  
   - **処理内容**:  
     - 対象のレコードを更新し、支払い金額などを修正。  

4. **参加者の削除**  
   - **エンドポイント例**: `[DELETE] /api/events/{event_id}/participants/{participant_id}`  
   - **処理内容**:  
     - 中間テーブル(`Event_Participants`)の該当レコードを削除し、参加関係を解除する。  

### 4.4 Discord通知

1. **通知タイミング**  
   - **新規イベント登録時**:  
     - イベントを登録した直後、DiscordのWebhookに対して「開催日時」「場所」「内容」などをメッセージ送信する。  
   - （将来的に検討）**イベント更新時、開催日前リマインド**など。  

2. **通知形式**  
   - **Webhook URL**: Discordチャンネルに設定された専用のURL。  
   - **送信内容**: JSONフォーマットで`username, content, embeds`などを含む形でDiscordに送信。  
   - **認証**: DiscordのWebhook側で特にトークンは不要だが、Webhook URLが漏洩しないよう管理する必要がある。  

## 5. 非機能要件

1. **ユーザー認証セキュリティ**  
   - パスワードはハッシュ化してDBに保存する（bcrypt等）。  
   - ログイン後の認証セッションはHTTPS通信を前提とし、安全なクッキー(HTTPOnly)またはJWTを使用する。  

2. **パフォーマンス**  
   - ユーザー数・イベント数が少ない想定（知人のみ）であるため、初期段階では高負荷対策は不要。  
   - 将来的にユーザーやイベントが増えた場合は、インデックス設計やキャッシュ機構を検討。  

3. **可用性・監視**  
   - MVP段階では必須ではないが、障害発生時の復旧手順(バックアップ/リストア)を最低限準備。  
   - 必要に応じてアプリログを取得し、簡易的に監視ができるようにする。  

4. **拡張性**  
   - 将来、通知タイミング変更や費用管理の高度化（レポート機能など）を視野に入れて設計。  
   - DBスキーマやコード構成は、追加要件を取り込みやすい形にする。  

5. **レスポンシブ対応**  
   - PC、スマホの両方に対応する。  
   - 軽量なUIフレームワーク（Tailwind CSSやBulmaなど）を利用。  

## 6. 画面イメージ・デザイン指針

1. **画面一覧**  
   - **ログイン画面**: ユーザー名/パスワードの入力フォーム  
   - **ユーザー登録画面**: ユーザー名、メール、パスワードを入力  
   - **イベント一覧画面**: イベントのリスト表示・検索機能・新規作成ボタン  
   - **イベント登録/編集画面**: 日時、場所、内容、ステータス などを入力  
   - **イベント詳細画面**: イベント情報と参加者リスト、参加者追加フォーム  

2. **デザインポリシー**  
   - カラーテーマはシンプル（モノトーン＋アクセント程度）  
   - 文字サイズや要素配置を、PC/スマホ両方で見やすいように設計  
   - フレームワークのユーティリティクラスを活用し、余白やフォントサイズを一貫させる  

## 7. システム構成・技術選定（想定例）

1. **フロントエンド**  
   - **言語**: JavaScript or TypeScript  
   - **フレームワーク**: React or Vueなど（好みや開発経験で選択）  
   - **UIフレームワーク**: Tailwind CSS, Bulma, etc.  

2. **バックエンド**  
   - **言語**: Node.js (Express/Fastify) / Python (Django/FastAPI) / PHP (Laravel) など  
   - **認証**: セッション＋クッキー or JWT  
   - **通知**: Discord Webhook連携（axiosなどのHTTPクライアントでPOST）  

3. **データベース**  
   - **種類**: MySQL / PostgreSQL など  
   - **テーブル構成**:  
     - `Users` (ユーザー情報)  
     - `Events` (イベント情報)  
     - `Event_Participants` (参加者中間テーブル、費用管理含む)  

4. **インフラ・デプロイ**  
   - MVP段階はHerokuやRender、Vercelなどを利用し簡易的にデプロイするか、AWS EC2で運用。  
   - ドメインやSSL証明書は必要に応じて設定する。  

## 8. 運用・拡張

1. **運用開始時の注意点**  
   - 管理者ユーザーの初期設定（手動でDBに登録 or 管理画面で登録）  
   - Discord Webhook URLの設定方法をドキュメント化  

2. **今後の追加機能候補**  
   - 通知タイミングの自由設定（開催○日前リマインドなど）  
   - レポート/集計機能（期間別、ユーザー別などの費用合計）  
   - イベント画像や補足ファイルのアップロード（外部ストレージ連携）  
   - 決済機能（オンライン決済導入）  
